# import the necessary packages
#沈楷  
import cv2 as cv
import keras.backend as K
import numpy as np
import scipy.io
from utils import load_model
logo =['AM General Hummer SUV 2000',
'Acura RL Sedan 2012',
'Acura TL Sedan 2012',
'Acura TL Type-S 2008',
'讴歌TSX轿车2012',
'Acura Integra Type R 2001',
'Acura ZDX两厢车2012',
'阿斯顿马丁V8 Vantage敞篷车2012',
'阿斯顿马丁V8 Vantage Coupe 2012',
'阿斯顿马丁Virage敞篷车2012',
'阿斯顿马丁Virage Coupe 2012',
'奥迪RS 4敞篷车2008',
'奥迪A5 Coupe 2012',
'奥迪TTS Coupe 2012',
'奥迪R8 Coupe 2012',
'奥迪V8轿车1994',
'奥迪100轿车1994年',
'1994年奥迪100旅行车',
'奥迪TT两厢车2011',
'奥迪S6轿车2011',
'奥迪S5敞篷车2012',
'奥迪S5 Coupe 2012',
'奥迪S4 Sedan 2012',
'奥迪S4 Sedan 2007',
'奥迪TT RS Coupe 2012',
'BMW ActiveHybrid 5 Sedan 2012',
'宝马1系敞篷车2012',
'宝马 1系双门轿跑车2012',
'宝马3系轿车2012',
'2012年宝马3系列旅行车',
'宝马6系敞篷车2007',
'宝马 X5 SUV 2007',
'宝马X6 SUV 2012',
'宝马 M3 Coupe 2012',
'宝马M5轿车2010',
'宝马 M6敞篷车2010',
'宝马X3 SUV 2012',
'宝马 Z4敞篷车2012',
'Bentley Continental Supersports Conv 敞篷车2012',
'Bentley Arnage Sedan 2009',
'Bentley Mulsanne Sedan 2011',
'宾利欧陆GT Coupe 2012',
'宾利欧陆GT Coupe 2007',
'Bentley Continental Flying Spur Sedan 2007',
'布加迪威龙16.4敞篷车2009',
'Bugatti Veyron 16.4 Coupe 2009',
'别克君威GS 2012',
'别克雷尼尔SUV 2007',
'别克Verano轿车2012年',
'别克Enclave SUV 2012',
'凯迪拉克CTS-V轿车2012',
'凯迪拉克SRX SUV 2012',
'凯迪拉克Escalade EXT Crew Cab 2007',
'雪佛兰Silverado 1500 Hybrid Crew Cab 2012',
'雪佛兰Corvette敞篷车2012',
'雪佛兰Corvette ZR1 2012',
'雪佛兰Corvette Ron Fellows Edition Z06 2007',
'雪佛兰Traverse SUV 2012',
'雪佛兰Camaro敞篷车2012',
'雪佛兰HHR SS 2010',
'雪佛兰Impala Sedan 2007',
'雪佛兰Tahoe混合动力SUV 2012',
'雪佛兰Sonic Sedan 2012',
'雪佛兰Express Cargo Van 2007',
'雪佛兰Avalanche Crew Cab 2012',
'雪佛兰Cobalt SS 2010',
'雪佛兰Malibu混合轿车2010',
'雪佛兰TrailBlazer SS 2009',
'雪佛兰Silverado 2500HD普通驾驶室2012',
'雪佛兰Silverado 1500 Classic Extended Cab 2007',
'雪佛兰Express Van 2007',
'雪佛兰蒙特卡洛Coupe 2007',
'雪佛兰Malibu Sedan 2007',
'雪佛兰Silverado 1500 Extended Cab 2012',
'雪佛兰Silverado 1500 Regular Cab 2012',
'克莱斯勒Aspen SU??V 2009',
'克莱斯勒Sebring敞篷车2010',
'克莱斯勒镇和国家小型货车2012',
'克莱斯勒300 SRT-8 2010',
'克莱斯勒Crossfire敞篷车2008',
'克莱斯勒PT Cruiser敞篷车2008',
'大宇努比拉旅行车2002',
'道奇Caliber Wagon 2012',
'道奇Caliber Wagon 2007',
'道奇Caravan Minivan 1997',
'Dodge Ram Pickup 3500 Crew Cab 2010',
'道奇Ram Pickup 3500 Quad Cab 2009',
'道奇Sprinter Cargo Van 2009',
'道奇之旅SUV 2012',
'Dodge Dakota Crew Cab 2010',
'Dodge Dakota Club Cab 2007',
'道奇Magnum Wagon 2008',
'道奇挑战者SRT8 2011',
'道奇Durango SUV 2012',
'Dodge Durango SUV 2007',
'道奇充电器轿车2012年',
'道奇Charger SRT-8 2009',
'Eagle Talon两厢车1998',
'FIAT 500 Abarth 2012',
'FIAT 500 Convertible 2012',
'法拉利FF Coupe 2012',
'法拉利California Convertible 2012',
'法拉利458 Italia Convertible 2012',
'法拉利458 Italia Coupe 2012',
'Fisker Karma Sedan 2012',
'福特F-450 Super Duty Crew Cab 2012',
'福特野马敞篷车2007',
'福特Freestar小型货车2007',
'福特Expedition EL SUV 2009',
'福特Edge SUV 2012',
'福特Ranger SuperCab 2011',
'福特GT Coupe 2006',
'福特F-150普通驾驶室2012',
'福特F-150普通驾驶室2007',
'福特福克斯轿车2007',
'福特E系列旅行车2012',
'福特嘉年华轿车2012',
'GMC Terrain SUV 2012',
'GMC Savana Van 2012',
'GMC Yukon Hybrid SUV 2012',
'GMC Acadia SUV 2012',
'GMC Canyon Extended Cab 2012',
'Geo Metro Convertible 1993',
'HUMMER H3T Crew Cab 2010',
'HUMMER H2 SUT Crew Cab 2009',
'本田奥德赛小型货车2012',
'本田奥德赛小型货车2007',
'本田雅阁Coupe 2012',
'本田雅阁轿车2012',
'现代Veloster两厢车2012',
'现代圣达菲SUV 2012',
'现代途胜SUV 2012',
'现代韦拉克鲁斯SUV 2012',
'现代索纳塔混合动力轿车2012',
'现代伊兰特轿车2007',
'现代雅绅特轿车2012',
'现代创世纪轿车2012',
'现代索纳塔轿车2012',
'现代伊兰特旅行两厢车2012',
'现代Azera Sedan 2012',
'英菲尼迪G Coupe IPL 2012',
'英菲尼迪QX56 SUV 2011',
'五十铃Ascender SUV 2008',
'捷豹XK XKR 2012',
'吉普爱国者SUV 2012',
'吉普牧马人SUV 2012',
'吉普自由SUV 2012',
'吉普大切诺基SUV 2012',
'吉普指南针SUV 2012',
'兰博基尼Reventon Coupe 2008',
'兰博基尼Aventador Coupe 2012',
'兰博基尼Gallardo LP 570-4 Superleggera 2012',
'兰博基尼暗黑破坏神Coupe 2001',
'路虎揽胜SUV 2012',
'路虎LR2 SUV 2012',
'林肯镇汽车轿车2011年',
'MINI Cooper Roadster敞篷车2012',
'迈巴赫Landaulet敞篷车2012',
'马自达Tribute SUV 2011',
'迈凯轮MP4-12C Coupe 2012',
'梅赛德斯 - 奔驰300级敞篷车1993',
'梅赛德斯 - 奔驰C级轿车2012',
'梅赛德斯 - 奔驰SL级轿跑车2009',
'梅赛德斯 - 奔驰E级轿车2012',
'梅赛德斯 - 奔驰S级轿车2012',
'梅赛德斯 - 奔驰Sprinter Van 2012',
'三菱Lancer轿车2012',
'日产Leaf两厢车2012',
'日产NV乘用车2012',
'日产Juke两厢车2012',
'日产240SX Coupe 1998',
'普利茅斯霓虹灯Coupe 1999',
'保时捷Panamera Sedan 2012',
'Ram C / V Cargo Van Minivan 2012',
'劳斯莱斯Phantom Drophead Coupe敞篷车2012',
'罗尔斯·罗伊斯幽灵轿车2012年',
'劳斯莱斯幻影轿车2012年',
'Scion xD两厢车2012',
'Spyker C8敞篷车2009',
'Spyker C8 Coupe 2009',
'铃木Aerio Sedan 2007',
'铃木Kizashi轿车2012年',
'铃木SX4两厢车2012',
'铃木SX4轿车2012',
'特斯拉Model S Sedan 2012',
'丰田红杉SUV 2012',
'丰田凯美瑞轿车2012',
'丰田卡罗拉轿车2012年',
'丰田4Runner SUV 2012',
'大众高尔夫两厢车2012',
'大众高尔夫两厢车1991',
'大众甲壳虫两厢车2012',
'沃尔沃C30两厢车2012',
'沃尔沃240 Sedan 1993',
'沃尔沃XC90 SUV 2007'
]
def carType(image_dir):

    img_width, img_height = 224, 224
    model = load_model()
    model.load_weights('models/model.96-0.89.hdf5')
    cars_meta = scipy.io.loadmat('devkit/cars_meta')
    class_names = cars_meta['class_names']  # shape=(1, 196)
    class_names = np.transpose(class_names)
    results = []
    filename = image_dir
    bgr_img = cv.imread(filename)
    bgr_img = cv.resize(bgr_img, (img_width, img_height), cv.INTER_CUBIC)
    rgb_img = cv.cvtColor(bgr_img, cv.COLOR_BGR2RGB)
    rgb_img = np.expand_dims(rgb_img, 0)
    preds = model.predict(rgb_img)
    prob = np.max(preds)
    class_id = np.argmax(preds)
    results.append({'label': class_names[class_id][0][0], 'prob': '{:.4}'.format(prob)})
    return logo[class_id]

    K.clear_session()

dir="data/test/00002.jpg"
a=carType(dir)
print(a)